-- Store the original properties of each player's character parts
local originalProperties = {}

-- Function to make all players visible through walls (turn red + transparent)
local function turnPlayersVisibleThroughWalls()
    for _, player in pairs(game.Players:GetPlayers()) do
        if player.Character then
            for _, part in pairs(player.Character:GetChildren()) do
                if part:IsA("BasePart") then
                    -- Save original properties if not already saved
                    if not originalProperties[player] then
                        originalProperties[player] = {}
                    end
                    originalProperties[player][part] = {
                        Color = part.Color,
                        Transparency = part.Transparency,
                        Material = part.Material
                    }

                    -- Change the properties to make them visible through walls
                    part.Color = Color3.new(1, 0, 0)  -- Red color
                    part.Transparency = 0.5  -- Semi-transparent
                    part.Material = Enum.Material.ForceField  -- Makes it easier to spot
                end
            end
        end
    end
end

-- Function to restore original properties of all players
local function restorePlayersProperties()
    for _, player in pairs(game.Players:GetPlayers()) do
        if player.Character and originalProperties[player] then
            for _, part in pairs(player.Character:GetChildren()) do
                if part:IsA("BasePart") and originalProperties[player][part] then
                    -- Restore the original properties
                    part.Color = originalProperties[player][part].Color
                    part.Transparency = originalProperties[player][part].Transparency
                    part.Material = originalProperties[player][part].Material
                end
            end
        end
    end
end

-- Function to handle chat commands
local function onPlayerChat(message, player)
    if message:lower() == ".enable" then
        -- Turn all players red and transparent to be visible through walls
        turnPlayersVisibleThroughWalls()
    elseif message:lower() == ".disable" then
        -- Restore all players' original colors and properties
        restorePlayersProperties()
    end
end

-- Bind to player chat
game.Players.PlayerAdded:Connect(function(player)
    player.Chatted:Connect(function(message)
        onPlayerChat(message, player)
    end)
end)

-- For players already in the game (if script runs after players join)
for _, player in pairs(game.Players:GetPlayers()) do
    player.Chatted:Connect(function(message)
        onPlayerChat(message, player)
    end)
end

print("Wallhack toggle script loaded!")
